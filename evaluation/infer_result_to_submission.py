"""
Convert the TUNA-CAP results obtained from VLMEvalKit inference into standard submission file (JSON format).
Each row in the Excel input should have 'index' and 'prediction' columns.
"""
import os
import json
import pandas as pd


def xlsx_to_json(file_path, output_path):
    """
    Convert an Excel file containing TUNA-CAP inference results into a JSON submission file.

    Args:
        file_path (str): Path to the input Excel file.
        output_path (str): Path where the output JSON file will be saved.
    """
    df = pd.read_excel(file_path, usecols=['index', 'prediction'])
    
    result_dict = df.set_index('index')['prediction'].to_dict()
    
    with open(output_path, 'w') as json_file:
        json.dump(result_dict, json_file, indent=2)
    print(f"Submission JSON saved to: {output_path}")


if __name__ == "__main__":
    # === Example usage ===
    # Input: Excel file generated by VLMEvalKit
    # Output: JSON file formatted for submission

    vlmevalkit_output_file = "" # e.g., "../VLMEvalKit/outputs/MODEL/T202xxx/MODEL_TUNA_CAP_1fps.xlsx"
    submission_file = ""        # # e.g., "./submissions/MODEL_TUNA_CAP_1fps_submission.json"

    os.makedirs(osp.dirname(submission_file), exist_ok=True)
    xlsx_to_json(vlmevalkit_output_file, submission_file)
    
